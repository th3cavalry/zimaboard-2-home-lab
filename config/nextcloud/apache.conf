<VirtualHost *:80>
    ServerName nextcloud.local
    DocumentRoot /var/www/nextcloud
    
    <Directory /var/www/nextcloud>
        AllowOverride All
        Require all granted
        Options FollowSymLinks MultiViews
        
        <IfModule mod_dav.c>
            Dav off
        </IfModule>
    </Directory>
    
    # Security headers
    Header always set Strict-Transport-Security "max-age=15552000; includeSubDomains"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "no-referrer"
    
    # Hide server information
    ServerTokens Prod
    ServerSignature Off
    
    # Logging
    ErrorLog /var/log/apache2/nextcloud_error.log
    CustomLog /var/log/apache2/nextcloud_access.log combined
    
    # PHP configuration
    <FilesMatch \.php$>
        SetHandler "proxy:unix:/var/run/php/php8.1-fpm.sock|fcgi://localhost"
    </FilesMatch>
    
    # Increase max file upload size
    php_value upload_max_filesize 16G
    php_value post_max_size 16G
    php_value max_execution_time 3600
    php_value max_input_time 3600
    php_value memory_limit 1G
</VirtualHost>
